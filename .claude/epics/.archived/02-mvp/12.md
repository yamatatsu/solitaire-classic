---
name: Game Engine TDD - Klondike rules validation
status: completed
created: 2025-09-19T07:43:36Z
updated: 2025-09-19T08:01:17Z
github: https://github.com/yamatatsu/solitaire-classic/issues/12
depends_on: [11]
parallel: false
conflicts_with: []
---

# Task: Game Engine TDD - Klondike rules validation

## Description
Test-driven implementation of Klondike rules validation functions in features/game/utils/. Implement comprehensive rule validation for all game moves including tableau to foundation, tableau to tableau, stock to waste, and waste to tableau movements. All functions must be pure and follow bulletproof-react patterns.

## Acceptance Criteria
- [ ] All Klondike rules implemented with TDD approach
- [ ] Move validation functions implemented in features/game/utils/
- [ ] 100% test coverage for all game logic functions
- [ ] Pure functions with no side effects
- [ ] Comprehensive test suite covers edge cases and rule violations
- [ ] Functions follow bulletproof-react naming and structure conventions

## Technical Details
- Implement pure functions for rule validation following bulletproof-react patterns
- Key validation functions needed:
  - `isValidTableauToFoundation(card, foundationPile)` - Ace to King sequence validation
  - `isValidTableauToTableau(cards, targetColumn)` - Alternating color descending sequence
  - `isValidWasteToTableau(card, targetColumn)` - Single card moves from waste
  - `isValidWasteToFoundation(card, foundationPile)` - Direct foundation building
  - `canFlipTableauCard(column, cardIndex)` - Face-down card reveal logic
- File location: `src/features/game/utils/move-validation.ts`
- Test file location: `src/features/game/utils/__tests__/move-validation.test.ts`
- Use Vitest for testing framework
- Follow existing project TypeScript patterns

## Dependencies
- [ ] Task 004 completed (Card models and game state)
- [ ] TypeScript types defined in features/game/types/
- [ ] Vitest testing framework available
- [ ] Project structure following bulletproof-react pattern

## Effort Estimate
- Size: L
- Hours: 20
- Parallel: false (depends on game state implementation)

## Definition of Done
- [ ] Code implemented with TDD approach
- [ ] All tests written and passing
- [ ] 100% test coverage achieved
- [ ] Code follows bulletproof-react patterns
- [ ] Functions are pure with no side effects
- [ ] Edge cases and error conditions tested
- [ ] Code reviewed and approved
